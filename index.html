<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å…§æ¹–é«˜ä¸­è»æ­¦ç¤¾</title>

  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AOS å‹•ç•« -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

  <!-- å­—é«” -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&family=Roboto&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      opacity: 1;
      transition: opacity 0.4s ease;
    }
    body.fade-out {
      opacity: 0;
    }
    h1, h2, h3 {
      font-family: 'Oswald', sans-serif;
    }
  </style>
</head>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<body class="bg-gray-900 text-white">
<header class="bg-green-900 p-4 flex justify-between items-center">
  <h1 class="text-xl md:text-2xl font-bold text-yellow-400">å…§æ¹–é«˜ä¸­è»æ­¦ç¤¾</h1>
  <div class="relative">
    <button id="menuBtn" class="bg-yellow-400 text-black px-4 py-2 rounded hover:bg-yellow-300 font-semibold text-sm md:text-base">
      â˜° é¸å–®
    </button>
    <div id="menuList" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded shadow-lg hidden z-50">
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/index.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ  é¦–é </a>
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/pages/map.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ—ºï¸ æ•™å®¤åœ°åœ–</a>
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/pages/schedule.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ“… æ´»å‹•æ’ç¨‹</a>
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/pages/checkin.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ“ ç¤¾èª²ç°½åˆ°</a>
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/pages/finance.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ’° è²¡å‹™ç´€éŒ„</a>
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/pages/knowledge.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ“š çŸ¥è­˜åˆ†äº«</a>
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/pages/about.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ– é—œæ–¼æˆ‘å€‘</a>
      <!-- å¹¹éƒ¨å¾Œå°é¸å–®é …ç›®ï¼ˆé è¨­éš±è—ï¼‰ -->
      <a href="pages/admin.html" id="adminLink" class="block px-4 py-2 text-white hover:bg-green-700 text-sm hidden">ğŸ›¡ï¸ å¹¹éƒ¨å¾Œå°</a>
      <!-- ç™»å‡ºæŒ‰éˆ•ï¼ˆé è¨­éš±è—ï¼‰ -->
      <button id="logoutBtn" class="block w-full text-left px-4 py-2 text-white hover:bg-red-700 text-sm hidden">ğŸšª ç™»å‡º</button>

    </div>
  </div>
</header>
<!-- å¹¹éƒ¨ç™»å…¥å€å¡Š -->
<div id="loginPanel" class="bg-gray-800 p-4 text-sm md:text-base text-white flex justify-between items-center">
  <div id="adminStatus">ğŸ”’ å¹¹éƒ¨å°šæœªç™»å…¥</div>
  <div class="space-x-2">
    <input type="email" id="adminEmail" placeholder="å¹¹éƒ¨ Email" class="px-2 py-1 rounded bg-gray-700 text-white border border-gray-500">
    <input type="password" id="adminPassword" placeholder="å¯†ç¢¼" class="px-2 py-1 rounded bg-gray-700 text-white border border-gray-500">
    <button id="loginBtn" class="bg-yellow-400 text-black px-3 py-1 rounded hover:bg-yellow-300">ç™»å…¥</button>
    <button id="logoutBtn" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 hidden">ç™»å‡º</button>
  </div>
</div>

<!-- ä¸»è¦–è¦ºå€ -->
<section class="relative bg-black text-white py-20 px-4 text-center overflow-hidden" data-aos="fade-up">
  <div class="absolute inset-0 bg-cover bg-center opacity-20" style="background-image: url('assets/images/IMG_1645.jpg');"></div>
  <div class="relative z-10 max-w-3xl mx-auto">
    <h1 class="text-3xl md:text-5xl font-bold text-yellow-300 mb-4 tracking-wide">ç´€å¾‹ãƒ»æ¦®è­½ãƒ»è²¬ä»»</h1>
    <p class="text-base md:text-xl text-gray-200 mb-6">æ‰“é€ æœ€å°ˆæ¥­çš„é«˜ä¸­è»æ­¦ç¤¾ç¶²ç«™</p>
    <a href="pages/about.html" class="inline-block bg-yellow-400 text-black font-semibold px-6 py-3 rounded hover:bg-yellow-300 transition transform hover:scale-105 text-sm md:text-base">èªè­˜æˆ‘å€‘ â†’</a>
  </div>
</section>

<!-- æœ€æ–°å…¬å‘Š -->
<section class="bg-green-950 text-white py-10 px-4 md:px-8" data-aos="fade-right">
  <div class="max-w-4xl mx-auto">
    <h2 class="text-xl md:text-2xl font-bold text-yellow-300 mb-4">ğŸ“£ æœ€æ–°å…¬å‘Š</h2>
    <ul id="announcementList" class="list-disc list-inside text-gray-200 space-y-2 text-sm md:text-base">
  <!-- å…¬å‘Šæœƒç”± JS è‡ªå‹•æ’å…¥ -->
    </ul>
  </div>
</section>

<!-- æ´»å‹•ç²¾è¯å½±ç‰‡ -->
<section class="bg-gray-900 text-white py-10 px-4 text-center" data-aos="zoom-in">
  <div class="max-w-4xl mx-auto">
    <h2 class="text-xl md:text-2xl font-bold text-yellow-300 mb-4">ğŸ¥ æ´»å‹•ç²¾è¯å½±ç‰‡</h2>
    <div class="relative w-full" style="padding-bottom: 56.25%;">
      <iframe
        src="https://www.youtube.com/embed/N3kuLgAiLJc"
        class="absolute top-0 left-0 w-full h-full rounded shadow-lg"
        frameborder="0"
        allowfullscreen
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        title="NHMC æ´»å‹•å½±ç‰‡">
      </iframe>
    </div>
    <p class="text-gray-400 mt-4 text-sm md:text-base">å½±ç‰‡ç”±å¹¹éƒ¨å‰ªè¼¯ï¼Œå®Œæ•´è¨˜éŒ„è»æ­¦ç¤¾çš„æ¦®è€€æ™‚åˆ»</p>
  </div>
</section>

<!-- æ¨¡çµ„å…¥å£å€ -->
<main class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 md:p-8">
  <!-- ç¤¾èª²ç°½åˆ° -->
  <a href="https://pyps0990-alt.github.io/nhmc9th.new/pages/checkin.html" class="block bg-green-800 hover:bg-green-700 rounded-lg p-6 shadow-lg transition transform hover:scale-105" data-aos="fade-up">
    <h2 class="text-yellow-300 text-xl font-bold mb-2">ğŸ“ ç¤¾èª²ç°½åˆ°</h2>
    <p class="text-gray-200 text-sm">ç¤¾åœ˜å°ˆç”¨ç°½åˆ°ç³»çµ±ï¼Œç´€éŒ„å‡ºå¸­ç‹€æ³ã€‚</p>
  </a>

  <!-- LINE ç¾¤çµ„é€£çµ -->
  <a href="https://line.me/ti/g/ssQssHJu4D" target="_blank" class="block bg-green-800 hover:bg-green-700 rounded-lg p-6 shadow-lg transition transform hover:scale-105" data-aos="fade-up" data-aos-delay="100">
    <h2 class="text-yellow-300 text-xl font-bold mb-2">ğŸ’¬ LINE ç¤¾ç¾¤</h2>
    <p class="text-gray-200 text-sm">é»æ“ŠåŠ å…¥è»æ­¦ç¤¾ LINE ç¾¤çµ„ï¼ŒæŒæ¡å³æ™‚é€šçŸ¥èˆ‡äº¤æµã€‚</p>
  </a>
</main>

<!-- JavaScript ä¿®æ­£é¸å–®èˆ‡è½‰å ´ -->
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBLsMAvPcpKBoeIfAA-hF2UGrrU5RRS7t4",
    authDomain: "nhmc9th-672f6.firebaseapp.com",
    projectId: "nhmc9th-672f6",
    appId: "1:470057381540:web:d5e0881cb540a7a58a0031"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const loginBtn = document.getElementById("loginBtn");
  // æ˜ç¢ºé¸å– loginPanel å…§çš„ç™»å‡ºæŒ‰éˆ•ï¼Œé¿å…èˆ‡é¸å–®å…§çš„ logoutBtn è¡çª
  const logoutBtn = document.querySelector("#loginPanel #logoutBtn");
  const menuLogoutBtn = document.getElementById("menuLogoutBtn");
  const adminStatus = document.getElementById("adminStatus");
  const loginPanel = document.getElementById("loginPanel");
  const adminLink = document.getElementById("adminLink");

  loginBtn.addEventListener("click", () => {
    const email = document.getElementById("adminEmail").value.trim();
    const password = document.getElementById("adminPassword").value.trim();
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        adminStatus.textContent = "âœ… å¹¹éƒ¨å·²ç™»å…¥";
        loginPanel.classList.add("hidden");
        adminLink.classList.remove("hidden");
        if (logoutBtn) logoutBtn.classList.remove("hidden");
        if (menuLogoutBtn) menuLogoutBtn.classList.remove("hidden");
      })
      .catch(err => {
        alert("ç™»å…¥å¤±æ•—ï¼š" + err.message);
      });
  });

  const db = firebase.database();
  const announceRef = db.ref("announcements");
  const announcementList = document.getElementById("announcementList");

  // åœ¨ callback è£¡è™•ç†ã€Œæ²’æœ‰å…¬å‘Šã€çš„é è¨­æ–‡å­—
  announceRef.on("value", snapshot => {
    const data = snapshot.val() || {};
    const now = Date.now();
    announcementList.innerHTML = "";

    Object.entries(data).forEach(([key, item]) => {
      if (item.expiresAt && item.expiresAt < now) return; // è·³ééæœŸå…¬å‘Š
      const time = item.timestamp ? new Date(item.timestamp).toLocaleDateString("zh-TW") : "";
      const li = document.createElement("li");
      li.innerHTML = `<span>${item.text || ""}<br><span class="text-xs text-gray-400">ğŸ•’ ç™¼å¸ƒï¼š${time}</span></span>`;
      announcementList.appendChild(li);
    });

    // è³‡æ–™è™•ç†å®Œæˆå¾Œå†æª¢æŸ¥æ˜¯å¦ç‚ºç©º
    if (announcementList.innerHTML === "") {
      announcementList.innerHTML = `<li class="text-gray-400">ç›®å‰æ²’æœ‰æœ‰æ•ˆå…¬å‘Š</li>`;
    }
  });

  // é¿å…å°ä¸å­˜åœ¨çš„ sw.js æ‹‹å‡ºéå¤šéŒ¯èª¤ï¼ˆå¯é¸ï¼‰
  if ('serviceWorker' in navigator) {
    fetch('/sw.js', { method: 'HEAD' })
      .then(res => {
        if (res.ok) {
          return navigator.serviceWorker.register('/sw.js')
            .then(reg => console.log('Service Worker registered'))
            .catch(err => console.error('Service Worker failed', err));
        }
      })
      .catch(() => { /* sw.js ä¸å­˜åœ¨æ™‚éœé»˜è·³é */ });
  }

  // ç™»å‡ºè¡Œç‚ºï¼ˆloginPanel è£¡çš„æŒ‰éˆ•ï¼‰
  logoutBtn?.addEventListener("click", () => {
    auth.signOut().then(() => {
      adminStatus.textContent = "ğŸ”’ å¹¹éƒ¨å°šæœªç™»å…¥";
      loginPanel.classList.remove("hidden");
      adminLink.classList.add("hidden");
      logoutBtn.classList.add("hidden");
      if (menuLogoutBtn) menuLogoutBtn.classList.add("hidden");
    });
  });

  // è‹¥è¦è®“é¸å–®å…§çš„ç™»å‡ºæŒ‰éˆ•ä¹Ÿèƒ½ç™»å‡º
  menuLogoutBtn?.addEventListener("click", () => {
    auth.signOut();
    menuLogoutBtn.classList.add("hidden");
  });

  auth.onAuthStateChanged(user => {
    if (user) {
      adminStatus.textContent = "âœ… å¹¹éƒ¨å·²ç™»å…¥";
      loginPanel.classList.add("hidden");
      adminLink.classList.remove("hidden");
      if (logoutBtn) logoutBtn.classList.remove("hidden");
      if (menuLogoutBtn) menuLogoutBtn.classList.remove("hidden");
    } else {
      adminStatus.textContent = "ğŸ”’ å¹¹éƒ¨å°šæœªç™»å…¥";
      loginPanel.classList.remove("hidden");
      adminLink.classList.add("hidden");
      if (logoutBtn) logoutBtn.classList.add("hidden");
      if (menuLogoutBtn) menuLogoutBtn.classList.add("hidden");
    }
  });

  AOS.init();

  document.querySelectorAll("a[href]").forEach(link => {
    link.addEventListener("click", function(e) {
      const href = this.getAttribute("href");
      const isInternal = href && !href.startsWith("http") && !href.startsWith("#") && !href.endsWith(".jpg");
      const isMenuLink = this.closest("#menuList");

      if (isInternal && !isMenuLink) {
        e.preventDefault();
        document.body.classList.add("fade-out");
        setTimeout(() => {
          window.location.href = href;
        }, 400);
      }
    });
  });
</script>


  AOS.init();

  document.querySelectorAll("a[href]").forEach(link => {
    link.addEventListener("click", function(e) {
      const href = this.getAttribute("href");
      const isInternal = href && !href.startsWith("http") && !href.startsWith("#") && !href.endsWith(".jpg");
      const isMenuLink = this.closest("#menuList");

      if (isInternal && !isMenuLink) {
        e.preventDefault();
        document.body.classList.add("fade-out");
        setTimeout(() => {
          window.location.href = href;
        }, 400);
      }
    });
  });
</script>

<!-- é å°¾ -->
<script>
  const menuBtn = document.getElementById("menuBtn");
  const menuList = document.getElementById("menuList");

  menuBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    menuList.classList.toggle("hidden");
  });

  document.addEventListener("click", (e) => {
    if (!menuBtn.contains(e.target) && !menuList.contains(e.target)) {
      menuList.classList.add("hidden");
    }
  });
</script>

<footer class="bg-gray-800 text-center p-4 text-xs md:text-sm text-gray-400">
  &copy; 2025 å…§æ¹–é«˜ä¸­è»æ­¦ç¤¾ | è¨­è¨ˆè€…ï¼šå¥•å˜‰
</footer>
</body>
</html>
