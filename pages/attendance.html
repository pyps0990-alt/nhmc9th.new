<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å‡ºç¼ºå‹¤é»å | å…§æ¹–é«˜ä¸­è»æ­¦ç¤¾</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <style>
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
</head>
<body class="bg-gray-900 text-white">

  <!-- å°è¦½åˆ— -->
  <header class="bg-green-900 p-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-yellow-400">å…§æ¹–é«˜ä¸­è»æ­¦ç¤¾</h1>
    <nav class="space-x-4">
      <a href="../index.html" class="hover:text-yellow-300">é¦–é </a>
      <a href="schedule.html" class="hover:text-yellow-300">æ´»å‹•æ’ç¨‹</a>
      <a href="attendance.html" class="text-yellow-300 font-bold">å‡ºç¼ºå‹¤</a>
      <a href="finance.html" class="hover:text-yellow-300">è²¡å‹™ç´€éŒ„</a>
      <a href="knowledge.html" class="hover:text-yellow-300">çŸ¥è­˜åˆ†äº«</a>
      <a href="about.html" class="hover:text-yellow-300">é—œæ–¼æˆ‘å€‘</a>
    </nav>
  </header>

  <!-- ä¸»å…§å®¹ -->
  <main class="p-8">
    <h2 class="text-3xl font-bold text-yellow-300 mb-4">âœ… å‡ºç¼ºå‹¤é»å</h2>

    <!-- æ—¥æœŸé¸æ“‡ -->
    <div class="mb-4">
      <label for="date-picker" class="mr-2">é¸æ“‡æ—¥æœŸï¼š</label>
      <input type="date" id="date-picker" class="text-black px-2 py-1 rounded">
    </div>

    <!-- Tabs -->
    <div id="tab-container" class="flex space-x-4 mb-6">
      <button class="tab-btn bg-green-700 px-4 py-2 rounded" data-tab="class1">ç¬¬1å ‚èª²</button>
    </div>

    <!-- æ§åˆ¶æŒ‰éˆ• -->
    <div class="mb-6 space-x-2">
      <button id="add-class" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500">â• æ–°å¢å ‚æ•¸</button>
      <button id="clear-data" class="bg-red-600 px-4 py-2 rounded hover:bg-red-500">ğŸ—‘ æ¸…é™¤ç´€éŒ„</button>
    </div>

    <!-- Tab å…§å®¹å®¹å™¨ -->
    <div id="content-container">
      <!-- ç¬¬1å ‚èª² -->
      <div id="class1" class="tab-content active">
        <table class="w-full bg-green-800 text-white rounded shadow mb-2">
          <thead>
            <tr class="bg-green-700">
              <th class="p-2 text-left">å§“å</th>
              <th class="p-2 text-center">å‡ºå¸­</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="p-2">20620 é™³å¥•å˜‰</td>
              <td class="p-2 text-center"><input type="checkbox" class="attendance-1"></td>
            </tr>
            <tr>
              <td class="p-2">20934 éŸ“æ€¡è±</td>
              <td class="p-2 text-center"><input type="checkbox" class="attendance-1"></td>
            </tr>
          </tbody>
        </table>
        å‡ºå¸­äººæ•¸ï¼š<span id="count-1" class="text-yellow-300 font-bold">0</span> äºº
      </div>
    </div>
  </main>

  <!-- JS -->
  <script>
    const tabContainer = document.getElementById("tab-container");
    const contentContainer = document.getElementById("content-container");
    const addClassBtn = document.getElementById("add-class");
    const clearBtn = document.getElementById("clear-data");
    const datePicker = document.getElementById("date-picker");
    let classCount = 1;
    let currentDate = new Date().toISOString().split("T")[0];
    datePicker.value = currentDate;

    // å„²å­˜åˆ° LocalStorageï¼ˆä¾æ—¥æœŸï¼‰
    function saveData() {
      const data = [];
      for (let i = 1; i <= classCount; i++) {
        const checkboxes = document.querySelectorAll(`.attendance-${i}`);
        const states = Array.from(checkboxes).map(cb => cb.checked);
        data.push({ classId: i, states });
      }
      localStorage.setItem("attendance-" + currentDate, JSON.stringify(data));
      localStorage.setItem("classCount-" + currentDate, classCount);
    }

    // è¼‰å…¥ LocalStorage
    function loadData() {
      const savedCount = localStorage.getItem("classCount-" + currentDate);
      if (savedCount) {
        classCount = parseInt(savedCount);
        for (let i = 2; i <= classCount; i++) {
          createClass(i);
        }
      }
      const savedData = JSON.parse(localStorage.getItem("attendance-" + currentDate) || "[]");
      savedData.forEach(d => {
        const checkboxes = document.querySelectorAll(`.attendance-${d.classId}`);
        d.states.forEach((state, idx) => {
          if (checkboxes[idx]) checkboxes[idx].checked = state;
        });
        updateCount(d.classId);
      });
    }

    // Tab åˆ‡æ›
    function switchTab(tabId, tabBtn) {
      document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
      document.querySelectorAll(".tab-btn").forEach(t => t.classList.remove("bg-yellow-500"));
      document.getElementById(tabId).classList.add("active");
      tabBtn.classList.add("bg-yellow-500");
    }

    tabContainer.addEventListener("click", e => {
      if (e.target.classList.contains("tab-btn")) {
        switchTab(e.target.dataset.tab, e.target);
      }
    });

    // å‡ºå‹¤è¨ˆç®—
    function setupAttendance(className, counterId, classId) {
      const checkboxes = document.querySelectorAll("." + className);
      const countDisplay = document.getElementById(counterId);

      function updateCount() {
        const count = Array.from(checkboxes).filter(cb => cb.checked).length;
        countDisplay.textContent = count;
        saveData();
      }

      checkboxes.forEach(cb => cb.addEventListener("change", updateCount));
      updateCount();
    }

    function updateCount(classId) {
      const checkboxes = document.querySelectorAll(`.attendance-${classId}`);
      const countDisplay = document.getElementById(`count-${classId}`);
      const count = Array.from(checkboxes).filter(cb => cb.checked).length;
      countDisplay.textContent = count;
    }

    // å»ºç«‹æ–°å ‚æ•¸
    function createClass(num) {
      const tabId = "class" + num;

      const newTab = document.createElement("button");
      newTab.className = "tab-btn bg-green-700 px-4 py-2 rounded";
      newTab.dataset.tab = tabId;
      newTab.textContent = `ç¬¬${num}å ‚èª²`;
      tabContainer.appendChild(newTab);

      const newContent = document.createElement("div");
      newContent.id = tabId;
      newContent.className = "tab-content";
      newContent.innerHTML = `
        <table class="w-full bg-green-800 text-white rounded shadow mb-2">
          <thead>
            <tr class="bg-green-700">
              <th class="p-2 text-left">å§“å</th>
              <th class="p-2 text-center">å‡ºå¸­</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="p-2">20620 é™³å¥•å˜‰</td>
              <td class="p-2 text-center"><input type="checkbox" class="attendance-${num}"></td>
            </tr>
            <tr>
              <td class="p-2">20934 éŸ“æ€¡è±</td>
              <td class="p-2 text-center"><input type="checkbox" class="attendance-${num}"></td>
            </tr>
          </tbody>
        </table>
        å‡ºå¸­äººæ•¸ï¼š<span id="count-${num}" class="text-yellow-300 font-bold">0</span> äºº
      `;
      contentContainer.appendChild(newContent);

      setupAttendance(`attendance-${num}`, `count-${num}`, num);
    }

    // æ–°å¢å ‚æ•¸
    addClassBtn.addEventListener("click", () => {
      classCount++;
      createClass(classCount);
      saveData();
    });

    // æ¸…é™¤ç´€éŒ„
    clearBtn.addEventListener("click", () => {
      if (confirm("ç¢ºå®šè¦æ¸…é™¤é€™å€‹æ—¥æœŸçš„å‡ºç¼ºå‹¤ç´€éŒ„å—ï¼Ÿ")) {
        localStorage.removeItem("attendance-" + currentDate);
        localStorage.removeItem("classCount-" + currentDate);
        location.reload();
      }
    });

    // æ—¥æœŸåˆ‡æ›
    datePicker.addEventListener("change", () => {
      currentDate = datePicker.value;
      // æ¸…ç©ºç•«é¢
      contentContainer.innerHTML = '';
      tabContainer.innerHTML = '';
      classCount = 1;
      // é‡å»ºç¬¬ä¸€å ‚èª²
      const firstTab = document.createElement("button");
      firstTab.className = "tab-btn bg-green-700 px-4 py-2 rounded";
      firstTab.dataset.tab = "class1";
      firstTab.textContent = "ç¬¬1å ‚èª²";
      tabContainer.appendChild(firstTab);

      const firstContent = document.createElement("div");
      firstContent.id = "class1";
      firstContent.className = "tab-content active";
      firstContent.innerHTML = `
        <table class="w-full bg-green-800 text-white rounded shadow mb-2">
          <thead>
            <tr class="bg-green-700">
              <th class="p-2 text-left">å§“å</th>
              <th class="p-2 text-center">å‡ºå¸­</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="p-2">20620 é™³å¥•å˜‰</td>
              <td class="p-2 text-center"><input type="checkbox" class="attendance-1"></td>
            </tr>
            <tr>
              <td class="p-2">20934 éŸ“æ€¡è±</td>
              <td class="p-2 text-center"><input type="checkbox" class="attendance-1"></td>
            </tr>
          </tbody>
        </table>
        å‡ºå¸­äººæ•¸ï¼š<span id="count-1" class="text-yellow-300 font-bold">0</span> äºº
      `;
      contentContainer.appendChild(firstContent);

      setupAttendance("attendance-1", "count-1", 1);
      loadData();
    });

    // åˆå§‹åŒ–
    setupAttendance("attendance-1", "count-1", 1);
    loadData();
  </script>
</body>
</html>