<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è²¡å‹™ç´€éŒ„ | å…§æ¹–é«˜ä¸­è»æ­¦ç¤¾</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- å­—é«” -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&family=Roboto&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Roboto', sans-serif; }
    h1, h2 { font-family: 'Oswald', sans-serif; }
    .balance-card { background-color: #1E3A8A; color: #FDE68A; }
    table { border-collapse: separate; border-spacing: 0 0.5rem; }
    th, td { padding: 0.5rem; }
    th { font-weight: bold; }
    td { vertical-align: middle; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

<header class="bg-green-900 p-4 flex justify-between items-center">
  <h1 class="text-xl md:text-2xl font-bold text-yellow-400">å…§æ¹–é«˜ä¸­è»æ­¦ç¤¾</h1>
  <div class="relative">
    <button id="menuBtn" class="bg-yellow-400 text-black px-4 py-2 rounded hover:bg-yellow-300 font-semibold text-sm md:text-base">
      â˜° é¸å–®
    </button>
    <div id="menuList" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded shadow-lg hidden z-50">
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/index.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ  é¦–é </a>
      <a href="map.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ—ºï¸ æ•™å®¤åœ°åœ–</a>
      <a href="schedule.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ“… æ´»å‹•æ’ç¨‹</a>
      <a href="checkin.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ“ ç¤¾èª²ç°½åˆ°</a>
      <a href="finance.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ’° è²¡å‹™ç´€éŒ„</a>
      <a href="knowledge.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ“š çŸ¥è­˜åˆ†äº«</a>
      <a href="about.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">ğŸ– é—œæ–¼æˆ‘å€‘</a>
    </div>
  </div>
</header>

<main class="p-8 max-w-6xl mx-auto">
  <h2 class="text-3xl font-bold text-yellow-300 mb-6">ğŸ’° è²¡å‹™ç´€éŒ„</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- æ”¶å…¥è¡¨ -->
    <div>
      <h3 class="text-xl font-bold text-green-300 mb-2">ğŸ“¥ æ”¶å…¥</h3>
      <table class="bg-green-800 w-full rounded shadow-lg">
        <thead>
          <tr class="bg-green-700">
            <th class="text-left">é …ç›®</th>
            <th class="text-right">é‡‘é¡</th>
          </tr>
        </thead>
        <tbody id="incomeTable"></tbody>
      </table>
    </div>

    <!-- æ”¯å‡ºè¡¨ -->
    <div>
      <h3 class="text-xl font-bold text-red-300 mb-2">ğŸ“¤ æ”¯å‡º</h3>
      <table class="bg-red-800 w-full rounded shadow-lg">
        <thead>
          <tr class="bg-red-700">
            <th class="text-left">é …ç›®</th>
            <th class="text-right">é‡‘é¡</th>
          </tr>
        </thead>
        <tbody id="expenseTable"></tbody>
      </table>
    </div>
  </div>

  <!-- é¤˜é¡å¡ç‰‡ -->
  <div id="balanceCard" class="balance-card mt-8 p-4 rounded-lg text-2xl font-bold shadow-lg text-center">
    é¤˜é¡ï¼šNT$ 0
  </div>
</main>

<script>
  // é¸å–®
  const menuBtn = document.getElementById("menuBtn");
  const menuList = document.getElementById("menuList");
  menuBtn.addEventListener("click", () => menuList.classList.toggle("hidden"));
  document.addEventListener("click", e => { 
    if (!menuBtn.contains(e.target) && !menuList.contains(e.target)) menuList.classList.add("hidden");
  });

  // Firebase åˆå§‹åŒ–
  const firebaseConfig = {
    apiKey: "AIzaSyBLsMAvPcpKBoeIfAA-hF2UGrrU5RRS7t4",
    authDomain: "nhmc9th-672f6.firebaseapp.com",
    databaseURL: "https://nhmc9th-672f6-default-rtdb.firebaseio.com",
    projectId: "nhmc9th-672f6",
    storageBucket: "nhmc9th-672f6.appspot.com",
    messagingSenderId: "470057381540",
    appId: "1:470057381540:web:d5e0881cb540a7a58a0031"
  };
  window.onload = function() {
  const firebaseConfig = {
    apiKey: "...",
    authDomain: "...",
    databaseURL: "https://nhmc9th-672f6-default-rtdb.firebaseio.com",
    projectId: "...",
    storageBucket: "...",
    messagingSenderId: "...",
    appId: "..."
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const incomeTable = document.getElementById("incomeTable");
  const expenseTable = document.getElementById("expenseTable");
  const balanceCard = document.getElementById("balanceCard");

  function formatCurrency(num){
    return Number(num).toLocaleString('zh-TW', { style:'decimal' });
  }

  db.ref('finance/record').on('value', snapshot => {
    const data = snapshot.val() || {};
    incomeTable.innerHTML = '';
    expenseTable.innerHTML = '';
    let totalIncome = 0;
    let totalExpense = 0;

    if(data.income){
      Object.keys(data.income).forEach(key => {
        const item = data.income[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="font-semibold">${item.item}</td>
                        <td class="text-right font-mono">NT$ ${formatCurrency(item.amount)}</td>`;
        incomeTable.appendChild(tr);
        totalIncome += Number(item.amount);
      });
    }

    if(data.expense){
      Object.keys(data.expense).forEach(key => {
        const item = data.expense[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="font-semibold">${item.item}</td>
                        <td class="text-right font-mono">NT$ ${formatCurrency(item.amount)}</td>`;
        expenseTable.appendChild(tr);
        totalExpense += Number(item.amount);
      });
    }

    balanceCard.textContent = `é¤˜é¡ï¼šNT$ ${formatCurrency(totalIncome - totalExpense)}`;
  });
};
</script>

<footer class="bg-gray-800 text-center p-4 text-sm text-gray-400">
  &copy; 2025 å…§æ¹–é«˜ä¸­è»æ­¦ç¤¾ | è¨­è¨ˆè€…ï¼šå¥•å˜‰
</footer>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</body>
</html>
