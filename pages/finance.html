<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>財務紀錄 | 內湖高中軍武社</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 字體 -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&family=Roboto&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Roboto', sans-serif; }
    h1, h2 { font-family: 'Oswald', sans-serif; }
    .balance-card { background-color: #1E3A8A; color: #FDE68A; }
    table { border-collapse: separate; border-spacing: 0 0.5rem; }
    th, td { padding: 0.5rem; }
    th { font-weight: bold; }
    td { vertical-align: middle; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

<header class="bg-green-900 p-4 flex justify-between items-center">
  <h1 class="text-xl md:text-2xl font-bold text-yellow-400">內湖高中軍武社</h1>
  <div class="relative">
    <button id="menuBtn" class="bg-yellow-400 text-black px-4 py-2 rounded hover:bg-yellow-300 font-semibold text-sm md:text-base">
      ☰ 選單
    </button>
    <div id="menuList" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded shadow-lg hidden z-50">
      <a href="https://pyps0990-alt.github.io/nhmc9th.new/index.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">🏠 首頁</a>
      <a href="map.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">🗺️ 教室地圖</a>
      <a href="schedule.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">📅 活動排程</a>
      <a href="checkin.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">📝 社課簽到</a>
      <a href="finance.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">💰 財務紀錄</a>
      <a href="knowledge.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">📚 知識分享</a>
      <a href="about.html" class="block px-4 py-2 text-white hover:bg-green-700 text-sm">🎖 關於我們</a>
    </div>
  </div>
</header>

<main class="p-8 max-w-6xl mx-auto">
  <h2 class="text-3xl font-bold text-yellow-300 mb-6">💰 財務紀錄</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- 收入表 -->
    <div>
      <h3 class="text-xl font-bold text-green-300 mb-2">📥 收入</h3>
      <table class="bg-green-800 w-full rounded shadow-lg">
        <thead>
          <tr class="bg-green-700">
            <th class="text-left">項目</th>
            <th class="text-right">金額</th>
          </tr>
        </thead>
        <tbody id="incomeTable"></tbody>
      </table>
    </div>

    <!-- 支出表 -->
    <div>
      <h3 class="text-xl font-bold text-red-300 mb-2">📤 支出</h3>
      <table class="bg-red-800 w-full rounded shadow-lg">
        <thead>
          <tr class="bg-red-700">
            <th class="text-left">項目</th>
            <th class="text-right">金額</th>
          </tr>
        </thead>
        <tbody id="expenseTable"></tbody>
      </table>
    </div>
  </div>

  <!-- 餘額卡片 -->
  <div id="balanceCard" class="balance-card mt-8 p-4 rounded-lg text-2xl font-bold shadow-lg text-center">
    餘額：NT$ 0
  </div>
</main>

<script>
  // 選單
  const menuBtn = document.getElementById("menuBtn");
  const menuList = document.getElementById("menuList");
  menuBtn.addEventListener("click", () => menuList.classList.toggle("hidden"));
  document.addEventListener("click", e => { 
    if (!menuBtn.contains(e.target) && !menuList.contains(e.target)) menuList.classList.add("hidden");
  });

  // Firebase 初始化
  const firebaseConfig = {
    apiKey: "AIzaSyBLsMAvPcpKBoeIfAA-hF2UGrrU5RRS7t4",
    authDomain: "nhmc9th-672f6.firebaseapp.com",
    databaseURL: "https://nhmc9th-672f6-default-rtdb.firebaseio.com",
    projectId: "nhmc9th-672f6",
    storageBucket: "nhmc9th-672f6.appspot.com",
    messagingSenderId: "470057381540",
    appId: "1:470057381540:web:d5e0881cb540a7a58a0031"
  };
  window.onload = function() {
  const firebaseConfig = {
    apiKey: "...",
    authDomain: "...",
    databaseURL: "https://nhmc9th-672f6-default-rtdb.firebaseio.com",
    projectId: "...",
    storageBucket: "...",
    messagingSenderId: "...",
    appId: "..."
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const incomeTable = document.getElementById("incomeTable");
  const expenseTable = document.getElementById("expenseTable");
  const balanceCard = document.getElementById("balanceCard");

  function formatCurrency(num){
    return Number(num).toLocaleString('zh-TW', { style:'decimal' });
  }

  db.ref('finance/record').on('value', snapshot => {
    const data = snapshot.val() || {};
    incomeTable.innerHTML = '';
    expenseTable.innerHTML = '';
    let totalIncome = 0;
    let totalExpense = 0;

    if(data.income){
      Object.keys(data.income).forEach(key => {
        const item = data.income[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="font-semibold">${item.item}</td>
                        <td class="text-right font-mono">NT$ ${formatCurrency(item.amount)}</td>`;
        incomeTable.appendChild(tr);
        totalIncome += Number(item.amount);
      });
    }

    if(data.expense){
      Object.keys(data.expense).forEach(key => {
        const item = data.expense[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="font-semibold">${item.item}</td>
                        <td class="text-right font-mono">NT$ ${formatCurrency(item.amount)}</td>`;
        expenseTable.appendChild(tr);
        totalExpense += Number(item.amount);
      });
    }

    balanceCard.textContent = `餘額：NT$ ${formatCurrency(totalIncome - totalExpense)}`;
  });
};
</script>

<footer class="bg-gray-800 text-center p-4 text-sm text-gray-400">
  &copy; 2025 內湖高中軍武社 | 設計者：奕嘉
</footer>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</body>
</html>
